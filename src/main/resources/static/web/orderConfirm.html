<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zxx">
<!--<![endif]-->
<!-- Begin Head -->

<head>
    <title>CSGO装备商城</title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <meta name="MobileOptimized" content="320">
    <!--导入核心文件-->
    <script src="../bootstrap3/js/holder.js"></script>
    <link href="../bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script src="../bootstrap3/jquery-1.9.1.min.js"></script>
    <!--Start Style -->
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/icofont.min.css">
    <link rel="stylesheet" type="text/css" href="../css/style.css">
	<link rel="stylesheet" id="theme-change" type="text/css" href="">
    <!--  icon  -->
    <link rel="stylesheet" type="text/css" href="../css/icon.css">
    <style type="text/css">
        #form-create-order{
            position: relative;
            left: 10%;
        }
        #number,#total-price{
            color: #00acee;
        }
    </style>
</head>


<body>
	<div class="loader">
	  <div class="spinner">
		<img src="../picture/loader.gif" alt="">
	  </div>
	</div>
    <!-- Main Body -->
    <div class="page-wrapper">
        <!-- Header Start -->
        <header class="header-wrapper main-header" id="header">
            <!--      header内容      -->
        </header>
        <!-- Sidebar Start -->
        <aside class="sidebar-wrapper" id="sidebar">

        </aside>
        <!-- Container Start -->
        <div class="page-wrapper">
            <div class="main-content">
                <!-- Page Title Start -->
                <div class="row">
                    <div class="colxl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                        <div class="page-title-wrapper">
                            <div class="page-title-box">
                                <h4 class="page-title bold">orderConfirm</h4>
                            </div>
                            <div class="breadcrumb-list">
                                <ul>
                                    <li class="breadcrumb-link active">orderConfirm</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Table Start -->
                <div class="row">
                    <!-- Styled Table Card-->
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                        <div class="card table-card">
                            <div class="card-header pb-0">
                                <h4>orderConfirm</h4>
                            </div>
                            <div class="card-body pb-4">
                                <div class="chart-holder">
                                    <div class="table-responsive">
                                        <form  id="form-create-order">
                                        <table class="table table-styled mb-0" id="table">
                                            <thead>
                                                <tr>
                                                    <th style="display: none"></th>
                                                    <th></th>
                                                    <th>装备展示</th>
                                                    <th>装备名称</th>
                                                    <th>类型</th>
                                                    <th>价格</th>
                                                </tr>
                                            </thead>
                                            <tbody id="cart-list">
                                                <tr>
                                                    <td>
                                                        <div class="img-chair">
                                                            <img src="../picture/product.png" alt=" ">
                                                        </div>
                                                    </td>
                                                    <td>Dining Chair</td>
                                                    <td>$86</td>
                                                    <td><a href="javascript:;"><i class="far fa-times-circle"></i></a></td>
                                                    <td>$375</td>
                                                </tr>
												<tr>
                                                    <td>
                                                        <div class="img-chair">
                                                            <img src="../picture/product2.png" alt=" ">
                                                        </div>
                                                    </td>
                                                    <td>Ceiling Light</td>
                                                    <td>$79</td>
                                                    <td><a href="javascript:;"><i class="far fa-times-circle"></i></a></td>
                                                    <td>$275</td>
                                                </tr>
												<tr>
                                                    <td>
                                                        <div class="img-chair">
                                                            <img src="../picture/product3.png" alt=" ">
                                                        </div>
                                                    </td>
                                                    <td>Wooden Sofa</td>
                                                    <td>$96</td>
                                                    <td><a href="javascript:;"><i class="far fa-times-circle"></i></a></td>
                                                    <td>$475</td>
                                                </tr>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td>已选商品<span id="number"></span>件￥<span id="total-price"></span></td>
                                                </tr>
                                                <tr>
                                                    <td> </td>
                                                    <td> </td>
                                                    <td></td>
                                                    <td><a href="cart.html" class="btn btn-success squer-btn mt-2 mr-2">返回购物车</a></td>
                                                    <td><input type="button" id="btn-create-order" value="  支  付  " class="btn btn-success squer-btn mt-2 mr-2" /></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ad-footer-btm">
                    <p>Copyright &copy; 2023.github.com/huangguoyonggithub.<a target="_blank" href="https://github.com/huangguoyonggithub/" style="color: #00acee">Go to</a></p>
                </div>
			</div>
		</div>
	</div>
    <!-- Script Start -->
    <script src="../js/jquery.min.js"></script>
    <script src="../js/popper.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/custom.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#sidebar').load('sidebar.html'); //加载公共html部分
            $('#header').load('header.html'); //加载公共html部分
            showCartList();
        })


        function showCartList() {
            $("#cart-list").empty();
            $.ajax({
                url: "/carts/list",
                type: "GET",
                data : location.search.substr(1), //地址栏上的数据，1代表？后的数据，0代表？前的
                dataType: "JSON",
                success: function(json) {
                    if (json.state == 200){
                        let list = json.data;
                        let num = 0;
                        let sum = 0;
                        for (let i = 0; i < list.length; i++) {
                            let tr = '<tr class="cart-page-data">'
                                + '<td style="display: none">#{cid}</td>'
                                + '<td></td>'
                                + '<td>'
                                + '<div class="img-chair">'
                                + '<img src="#{image}" alt=" ">'
                                + '</div>'
                                + '</td>'
                                + '<td><input type="hidden" name="cids" value="#{cid}" />#{title}</td>'
                                + '<td>#{good_type}</td>'
                                + '<td>￥<b id="price-#{cid}">#{price}</b></td>'
                                + '</tr>';

                            tr = tr.replace(/#{cid}/g, list[i].cid);
                            tr = tr.replace(/#{image}/g, list[i].image);
                            tr = tr.replace(/#{good_type}/g, list[i].goodType);
                            tr = tr.replace(/#{title}/g, list[i].title);
                            tr = tr.replace(/#{price}/g, list[i].price);

                            num ++;
                            sum +=  list[i].price;

                            $("#cart-list").append(tr);
                        }
                        $("#number").html(num);
                        $("#total-price").html(sum);
                    }
                },
                error : function (xhr) {
                    alert("购物车列表数据加载产生未知异常，" + xhr.status);
                }
            });
        }

        $("#btn-create-order").click(function () {
            // let cids = location.search.substr(1) //获取？后面的所有数据
            $.ajax({
                url: "/orders/create",
                data: $("#form-create-order").serialize(),//前提<input type="hidden" name="cids" value="#{cid}" />否则无法获取cids
                //data : "aid=" + aid + "$" + cids   // cids : cids=1$cids=2
                type: "POST",
                dataType: "JSON",
                success: function(json) {
                    if (json.state == 200) {
                        alert("创建订单成功！");
                        location.href = "paid-goods.html";
                    } else {
                        if (json.message == "用户余额不足，请进行充值！"){
                            alert("创建订单失败！" + json.message);
                            location.href = "recharge.html";
                        }else {
                            alert("创建订单失败！" + json.message);
                        }
                    }
                },
                error: function(xhr) {
                    alert("您的登录信息已经过期，请重新登录！HTTP响应码：" + xhr.status);
                    location.href = "login.html";
                }
            });
        });

    </script>
</body>

</html>