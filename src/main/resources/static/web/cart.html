<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zxx">
<!--<![endif]-->
<!-- Begin Head -->

<head>
    <title>CSGO装备商城</title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <meta name="MobileOptimized" content="320">
    <!--导入核心文件-->
    <script src="../bootstrap3/js/holder.js"></script>
    <link href="../bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script src="../bootstrap3/jquery-1.9.1.min.js"></script>
    <script src="../bootstrap3/js/bootstrap.js"></script>
    <!--Start Style -->
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/icofont.min.css">
    <link rel="stylesheet" type="text/css" href="../css/style.css">
	<link rel="stylesheet" id="theme-change" type="text/css" href="">
    <!--  icon  -->
    <link rel="stylesheet" type="text/css" href="../css/icon.css">
</head>


<body>
	<div class="loader">
	  <div class="spinner">
		<img src="../picture/loader.gif" alt="">
	  </div>
	</div>
    <!-- Main Body -->
    <div class="page-wrapper">
        <!-- Header Start -->
        <header class="header-wrapper main-header" id="header">
            <!--      header内容      -->
        </header>
        <!-- Sidebar Start -->
        <aside class="sidebar-wrapper" id="sidebar">

        </aside>
        <!-- Container Start -->
        <div class="page-wrapper">
            <div class="main-content">
                <!-- Page Title Start -->
                <div class="row">
                    <div class="colxl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                        <div class="page-title-wrapper">
                            <div class="page-title-box">
                                <h4 class="page-title bold">Cart</h4>
                            </div>
                            <div class="breadcrumb-list">
                                <ul>
                                    <li class="breadcrumb-link">
                                        <a href="javascript:void(0);"><i class="fas fa-home mr-2"></i>Dashboard</a>
                                    </li>
                                    <li class="breadcrumb-link active">Cart</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Table Start -->
                <div class="row">
                    <!-- Styled Table Card-->
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                        <div class="card table-card">
                            <div class="card-header pb-0">
                                <h4>Cart</h4>
                            </div>
                            <div class="card-body pb-4">
                                <div class="chart-holder">
                                    <div class="table-responsive">
                                        <table class="table table-styled mb-0">
                                            <thead>
                                                <tr>
                                                    <th style="display: none"></th>
                                                    <th>装备展示</th>
                                                    <th>装备名称</th>
                                                    <th>价格</th>
                                                    <th>数量</th>
													<th>总价</th>
                                                    <th>操作</th>
                                                </tr>
                                            </thead>
                                            <tbody id="cart-list">
                                                <tr>
                                                    <td>
                                                        <div class="img-chair">
                                                            <img src="../picture/product.png" alt=" ">
                                                        </div>
                                                    </td>
                                                    <td>Dining Chair</td>
                                                    <td>$86</td>
                                                    <td>
														<div class="int-table-quantity">
															<div class="quantity-wrapper">
																<div class="input-group">
																	<span class="quantity-minus"> - </span>
																	<input type="number" class="quantity" value="2">
																	<span class="quantity-plus"> + </span>
																</div>
															</div>
														</div>
													</td>
                                                    <td><a href="javascript:;"><i class="far fa-times-circle"></i></a></td>
                                                    <td>$375</td>
                                                </tr>
												<tr>
                                                    <td>
                                                        <div class="img-chair">
                                                            <img src="../picture/product2.png" alt=" ">
                                                        </div>
                                                    </td>
                                                    <td>Ceiling Light</td>
                                                    <td>$79</td>
                                                    <td>
														<div class="int-table-quantity">
															<div class="quantity-wrapper">
																<div class="input-group">
																	<span class="quantity-minus"> - </span>
																	<input type="number" class="quantity" value="1">
																	<span class="quantity-plus"> + </span>
																</div>
															</div>
														</div>
													</td>
                                                    <td><a href="javascript:;"><i class="far fa-times-circle"></i></a></td>
                                                    <td>$275</td>
                                                </tr>
												<tr>
                                                    <td>
                                                        <div class="img-chair">
                                                            <img src="../picture/product3.png" alt=" ">
                                                        </div>
                                                    </td>
                                                    <td>Wooden Sofa</td>
                                                    <td>$96</td>
                                                    <td>
														<div class="int-table-quantity">
															<div class="quantity-wrapper">
																<div class="input-group">
																	<span class="quantity-minus"> - </span>
																	<input type="number" class="quantity" value="3">
																	<span class="quantity-plus"> + </span>
																</div>
															</div>
														</div>
													</td>
                                                    <td><a href="javascript:;"><i class="far fa-times-circle"></i></a></td>
                                                    <td>$475</td>
                                                </tr>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <td> </td>
                                                    <td>&nbsp;</td>
                                                    <td>&nbsp;</td>
                                                    <td><b>Total Price :</b></td>
                                                    <td>￥<b id="prices">6935.00</b></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>&nbsp;</td>
                                                    <td>&nbsp;</td>
                                                    <td>&nbsp;</td>
                                                    <td><a href="index.html" class="btn btn-danger squer-btn mt-2 mr-2">返回首页</a></td>
                                                    <td><a href="checkout.html" class="btn btn-success squer-btn mt-2 mr-2">结算</a></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ad-footer-btm">
                    <p>Copyright &copy; 2023.github.com/huangguoyonggithub.<a target="_blank" href="https://github.com/huangguoyonggithub/" style="color: #00acee">Go to</a></p>
                </div>
			</div>
		</div>
	</div>
    <!-- Script Start -->
    <script src="../js/jquery.min.js"></script>
    <script src="../js/popper.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/custom.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#sidebar').load('sidebar.html'); //加载公共html部分
            $('#header').load('header.html'); //加载公共html部分
            showCartList();
        })


        function num(obj) {
            // obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
            // obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字
            // obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个, 清除多余的
            // obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
            obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数
        }

        function showCartList() {
            $("#cart-list").empty();
            $.ajax({
                url: "/carts",
                type: "GET",
                dataType: "JSON",
                success: function(json) {
                    let list = json.data;
                    var sum = 0,totalPrice = 0;
                    for (let i = 0; i < list.length; i++) {
                        let tr = '<tr class="cart-page-data">'
                            + '<td style="display: none">#{cid}</td>'
                            + '<td>'
                            + '<div class="img-chair">'
                            + '<img src="#{image}" alt=" ">'
                            + '</div>'
                            + '</td>'
                            + '<td>#{title}</td>'
                            + '<td>￥<b id="price-#{cid}">#{price}</b></td>'
                            + '<td>'
                            + '<div class="int-table-quantity">'
                            + '<div class="quantity-wrapper">'
                            + '<div class="input-group">'
                            + '<span class="quantity-minus" onclick="minusNum(#{cid})"> - </span>'
                            + '<input type="number" class="quantity" value="#{num}" id="quantity-#{cid}">'
                            + '<span class="quantity-plus" onclick="plusNum(#{cid})"> + </span>'
                            + '</div>'
                            + '</div>'
                            + '</div>'
                            + '</td>'
                            + '<td>￥<b id="total-price-#{cid}" onkeyup="num(this)">#{totalPrice}</b></td>'
                            + '<td><a href="" onclick="delCartItem(#{cid})" class="btn btn-danger squer-btn mt-2 mr-2">删除</a></td>'
                            + '</tr>';

                        totalPrice = list[i].price * list[i].num;
                        sum = sum + totalPrice;

                        tr = tr.replace(/#{cid}/g, list[i].cid);
                        tr = tr.replace(/#{image}/g, list[i].image);
                        tr = tr.replace(/#{title}/g, list[i].title);
                        tr = tr.replace(/#{price}/g, list[i].price);
                        tr = tr.replace(/#{num}/g, list[i].num);
                        tr = tr.replace(/#{totalPrice}/g, totalPrice.toFixed(2));

                        $("#cart-list").append(tr);
                    }
                    $("#prices").html(sum.toFixed(2));
                },
                error : function (xhr) {
                    alert("购物车列表数据加载产生未知异常，" + xhr.status);
                }
            });
        }

        function delCartItem(cid) {
            $.ajax({
                url: "/carts/" + cid + "/delete_cart",
                type: "POST",
                dataType: "JSON",
                success: function(json) {
                    if (json.state == 200) {
                        $(this).parents(".cart-page-data").remove();
                    } else {
                        alert("删除购物车失败！" + json.message);
                    }
                },
                error: function(xhr) {
                    alert("您的登录信息已经过期，请重新登录！HTTP响应码：" + xhr.status);
                    location.href = "login.html";
                }
            });
        }

        function plusNum(cid) {
            $.ajax({
                url: "/carts/" + cid + "/num/plus",
                type: "POST",
                dataType: "JSON",
                success: function(json) {
                    if (json.state == 200) {
                        showCartList();
                    } else {
                        alert("增加商品数量失败！" + json.message);
                    }
                },
                error: function(xhr) {
                    alert("您的登录信息已经过期，请重新登录！HTTP响应码：" + xhr.status);
                    location.href = "login.html";
                }
            });
        }

        function minusNum(cid) {
            $.ajax({
                url: "/carts/" + cid + "/num/minus",
                type: "POST",
                dataType: "JSON",
                success: function(json) {
                    if (json.state == 200) {
                        showCartList();
                    } else {
                        alert("减少商品数量失败！" + json.message);
                    }
                },
                error: function(xhr) {
                    alert("您的登录信息已经过期，请重新登录！HTTP响应码：" + xhr.status);
                    location.href = "login.html";
                }
            });
        }

        /*
        $(function() {
            //返回链接
            $(".link-account").click(function() {
                location.href = "orderConfirm.html";
            })
        })
        */
    </script>
</body>

</html>